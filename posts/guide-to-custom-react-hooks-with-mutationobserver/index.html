<!DOCTYPE html><html lang="en-US" class="mx-4"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.5.12"><meta name="description" content="Blogpost, note taking and other things"><title>Guide to custom React Hooks (wrap the MutationObserver) - ~/</title><link rel="stylesheet" href="/_astro/bookshelf.DmiATZhB.css">
<style>:root{--color-primary-main: #222222;--color-secondary-main: #444444;--color-text-body: 55 65 81;--color-text-heading: 55 65 81;--color-text-link: var(--color-primary-main);--color-text-link-hover: var(--color-secondary-main);--color-border: var(--color-primary-main);--color-code-bg: #f3f4f6;scroll-behavior:smooth}:root.dark{color-scheme:dark;--color-primary-main: 235 153 161;--color-secondary-main: 226 111 122;--color-text-body: 214 211 209;--color-text-heading: 255 255 255;--color-text-link: var(--color-primary-main);--color-text-link-hover: var(--color-secondary-main);--color-border: var(--color-primary-main);--color-code-bg: #1a202c;scroll-behavior:smooth}body{font-family:Verdana,sans-serif;overflow-y:scroll}img{max-width:28rem}time,div{color:rgb(var(--color-text-heading))}.panda-link-static{text-decoration:none;color:rgb(var(--color-text-link))}.panda-link-static:hover{text-decoration-line:underline;text-underline-offset:4px;cursor:pointer}.panda-link-static:hover{color:rgb(var(--color-text-link-hover));text-decoration-thickness:.125rem;text-underline-offset:5px}.panda-link{text-decoration:none;color:rgb(var(--color-text-link))}.panda-link:hover{cursor:pointer}.panda-link:hover{color:rgb(var(--color-text-link-hover))}a.animated{--animated-underline-from: rgb(var(--color-text-link));--animated-underline-to: rgb(var(--color-text-link));position:relative;box-decoration-break:clone;text-decoration:none}a.animated:after{left:0;right:0;bottom:-4px;content:"";height:2px;width:auto;position:absolute;transform:translateZ(0) scaleX(0);transform-origin:left center;transition:all .25s ease-in-out;background-image:linear-gradient(to right,var(--animated-underline-from),var(--animated-underline-to))}a.animated:hover:after{transform:translateZ(0) scale(1)}a.animated.active:after{transform:translateZ(0) scale(1)}.max-width{margin-left:auto;margin-right:auto;max-width:65ch}.panda-text{--un-text-opacity:1;color:rgb(29 78 216 / var(--un-text-opacity));text-decoration:none;cursor:pointer}.panda-text:hover{text-decoration-line:underline;text-underline-offset:4px}.panda-text:hover{--un-text-opacity:1;color:rgb(29 78 216 / var(--un-text-opacity))}.dark .panda-text,.dark .panda-text:hover{--un-text-opacity:1;color:rgb(245 245 244 / var(--un-text-opacity))}.prose :where(a):not(:where([data-footnote-ref],[data-footnote-backref],.not-prose,.not-prose *)){padding-left:.25rem;padding-right:.25rem;text-decoration-line:underline;text-underline-offset:4px;hover:underline}.prose :where(blockquote):not(:where(.not-prose,.not-prose *)){padding:.5rem .5rem .5rem 1rem;margin:0;--un-bg-opacity:1;background-color:rgb(243 244 246 / var(--un-bg-opacity));border-radius:.125rem .5rem .5rem .125rem;border-left-style:solid;font-size:1rem;line-height:1.5rem;font-weight:400;border-left:6px solid rgb(var(--color-primary-main))!important}.dark .prose :where(blockquote):not(:where(.not-prose,.not-prose *)){--un-bg-opacity:1;background-color:rgb(87 83 78 / var(--un-bg-opacity))}.prose :where(ol>li):not(:where(.not-prose,.not-prose *))::marker,.prose :where(ul>li):not(:where(.not-prose,.not-prose *))::marker,.prose :where(summary):not(:where(.not-prose,.not-prose *))::marker{color:rgb(var(--color-primary-main));margin-right:1rem;font-weight:600}[data-footnote-ref]:before{content:" ["}[data-footnote-ref]:after{content:"] "}[data-footnote-backref]{text-decoration:none}[data-footnote-ref]{font-weight:400;text-decoration:none}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}
</style><script type="module">document.addEventListener("astro:page-load",setup);document.addEventListener("astro:after-swap",setup);
</script>
<script type="module" src="/_astro/page.55INgWwS.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[])})(window,'partytown','forward');/* Partytown 0.8.2 - MIT builder.io */
!function(t,e,n,i,o,r,a,s,d,c,l,p){function u(){p||(p=1,"/"==(a=(r.lib||"/~partytown/")+(r.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(s=setTimeout(f,1e4),e.addEventListener("pt0",w),o?h(1):n.serviceWorker?n.serviceWorker.register(a+(r.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.style.display="block",c.style.width="0",c.style.height="0",c.style.border="0",c.style.visibility="hidden",c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.8.2":"sandbox-sw.html?"+Date.now()),e.querySelector(r.sandboxParent||"body").appendChild(c)}function f(n,o){for(w(),i==t&&(r.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<d.length;n++)(o=e.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=r.nonce,e.head.appendChild(o);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(s)}r=t.partytown||{},i==t&&(r.forward||[]).map((function(e){l=t,e.split(".").map((function(e,n,i){l=l[i[n]]=n+1<i.length?"push"==i[n+1]?[]:l[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);;((d,s)=>(s=d.currentScript,d.addEventListener('astro:before-swap',()=>s.remove(),{once:true})))(document);</script></head> <body class="max-width dark:bg-stone-700"> <div class="my-6 flex"> <a href="/" class="hover:cursor-pointer opacity-100 hover:opacity-80 panda-link"> <i class="hidden">danielcaldas.github.io</i> <h1>~/</h1> </a> <div class="text-sm place-content-center inline ml-auto"> <button id="themeToggle" class="mt-1 cursor-pointer border-0 bg-transparent"> <svg width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="opacity-100 hover:opacity-80"> <path class="fill-black dark:fill-transparent" d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z"></path> <path class="fill-transparent dark:fill-white" d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z"></path> </svg> </button> <script>
    function handleToggleClick() {
        const element = document.documentElement
        element.classList.toggle('dark')
        const isDark = element.classList.contains('dark')
        localStorage.setItem('theme', isDark ? 'dark' : 'light')
    }

    function setup() {
        let current_theme
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            current_theme = localStorage.getItem('theme')
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            current_theme = 'dark'
        }
        current_theme = current_theme || 'light'
        if (current_theme === 'light') {
            document.documentElement.classList.remove('dark')
        } else {
            document.documentElement.classList.add('dark')
        }
        window.localStorage.setItem('theme', current_theme)
        // button event bind
        document.getElementById('themeToggle').addEventListener('click', handleToggleClick)
    }

    setup()
</script>  </div> </div>  <main>  <a rel="prefetch" class="panda-link mt-6" href="/">Back</a> <style>
        /* notification */
        .notification p {
            margin-top: 0;
            margin-bottom: 0;
            padding: 0.5rem 1rem;
            font-size: small;
        }

        .notification-warning {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }

        .notification-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .notification-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .notification-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .dark .notification-warning {
            background-color: #856404;
            border-color: #ffeeba;
            color: #fff3cd;
        }

        .dark .notification-danger {
            background-color: #721c24;
            border-color: #f5c6cb;
            color: #f8d7da;
        }

        .dark .notification-success {
            background-color: #155724;
            border-color: #c3e6cb;
            color: #d4edda;
        }

        .dark .notification-info {
            background-color: #0c5460;
            border-color: #bee5eb;
            color: #d1ecf1;
        }
    </style> <div class="mt-6"> <h1 class="text-4xl">Guide to custom React Hooks (wrap the MutationObserver)</h1> <div class="flex sm:flex-row flex-col rounded-lg bg-stone-100 dark:bg-stone-600 p-2 px-4"> <div> <span class="ml-2"> <a href="/tags/javascript" class="text-sm mr-2 panda-link">
#javascript </a> </span><span class="ml-2"> <a href="/tags/react" class="text-sm mr-2 panda-link">
#react </a> </span> </div> <span class="ml-auto mr-4 text-sm font-normal"> Posted on 21, Jul, 2021</span> </div> </div> <article class="prose dark:prose-invert prose-stone max-w-prose mt-6">  <!-- canonicalUrl: "https://blog.logrocket.com/guide-to-custom-react-hooks-with-mutationobserver/" -->
<p>This article was originally published by <a href="https://logrocket.com/" target="_blank" title="LogRocket Modern Frontend Monitoring and Product Analytics">LogRocket</a>. You can checkout the original post <a href="https://blog.logrocket.com/guide-to-custom-react-hooks-with-mutationobserver/" target="_blank" title="Guide to custom React Hooks with MutationObserver LogRocket Blog">here</a>.</p>
<p>With the introduction of React Hooks, the amount of shareable code within React codebases has exploded. Because Hooks are thin APIs on top of React, developers can collaborate by attaching reusable behavior to components and segregating these behaviors into smaller modules.</p>
<p>While this is similar to how JavaScript developers abstract business logic away in vanilla JavaScript modules, Hooks provide more than pure JavaScript functions. Instead of taking data in and out, developers can stretch the spectrum of possibilities of what can happen inside a Hook.</p>
<p>For instance, developers can:</p>
<ul>
<li>Mutate and manage a piece of state for a specific component or an entire application</li>
<li>Trigger side effects on a page, like changing the title of a browser tab</li>
<li>Rectify external APIs by tapping into React components’ lifecycle with Hooks</li>
</ul>
<p>In this post we’ll explore the latter possibility. As a case study, we’ll abstract the <code>MutationObserver</code> API in a custom React Hook, demonstrating how we can build robust, shareable pieces of logic in a React codebase.</p>
<p>We’ll create a dynamic label that updates itself to indicate how many items we have in a list. Instead of using the provided React state array of elements, we’ll use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver API</a> to detect added elements and update the label accordingly.</p>
<p><img  src="/_astro/fruits-example.CWBnkv61_2ckqVz.webp" alt="&#38;#x27;Update the dynamic label to count the number of fruits in the list&#38;#x27;" title="Update the dynamic label to count the number of fruits in the list" width="580" height="252" loading="lazy" decoding="async"></p>
<p><cite>source: <a href="https://blog.logrocket.com/guide-to-custom-react-hooks-with-mutationobserver/">https://blog.logrocket.com/guide-to-custom-react-hooks-with-mutationobserver/</a></cite></p>
<h2 id="implementation-overview"><a class="__permalink-h" href="#implementation-overview" aria-label="implementation overview permalink">»</a>Implementation overview</h2>
<p>The following code is a simple component that renders our list. It also updates a counter value that represents the number of fruits currently in the list:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.ggich.css"><script type="module" src="/_astro/ec.dy9ns.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">export</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">default</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">App</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">listRef</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">useRef</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">count</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">setCount</span><span style="--0:#C792EA;--1:#8D46B4">] = </span><span style="--0:#82AAFF;--1:#3C63B3">useState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">fruits</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">setFruits</span><span style="--0:#C792EA;--1:#8D46B4">] = </span><span style="--0:#82AAFF;--1:#3C63B3">useState</span><span style="--0:#D6DEEB;--1:#403F53">([</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">apple</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">peach</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">])</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">onListMutation</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">useCallback</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">mutationList</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3C63B3">setCount</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">mutationList</span><span style="--0:#D6DEEB">[</span></span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">target</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">children</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">length</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#7690A6;--1:#4F687D">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D7DBE0;--1:#403F53">setCount</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#7690A6;--1:#4F687D">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">listRef</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">current</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">onListMutation</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">div</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">span</span><span style="--0:#7FDBCA">></span></span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Added </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">count</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> fruits</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">span</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">br</span><span style="--0:#7FDBCA"> /></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">button</span><span style="--0:#7FDBCA"> </span></span><span style="--0:#C5E478;--1:#3C63B3">onClick</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA"> </span><span style="--0:#C792EA">=></span><span style="--0:#7FDBCA"> </span></span><span style="--0:#82AAFF;--1:#3C63B3">setFruits</span><span style="--0:#D6DEEB;--1:#403F53">([</span><span style="--0:#7FDBCA;--1:#097174">...</span><span style="--0:#D7DBE0;--1:#403F53">fruits</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">random fruit </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#7FDBCA;--1:#097174">fruits</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">length</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">])</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#7FDBCA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53">Add random fruit</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">button</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">ul</span><span style="--0:#7FDBCA"> </span></span><span style="--0:#C5E478;--1:#3C63B3">ref</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#D7DBE0;--1:#403F53">listRef</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#7FDBCA;--1:#8D46B4">></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#7FDBCA;--1:#097174">fruits</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">f</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">li</span><span style="--0:#7FDBCA"> </span></span><span style="--0:#C5E478;--1:#3C63B3">key</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#D7DBE0;--1:#403F53">f</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#7FDBCA;--1:#8D46B4">></span><span style="--0:#DD6B68;--1:#B73936">{</span><span style="--0:#D7DBE0;--1:#403F53">f</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">li</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#DD6B68;--1:#B73936">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">ul</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">div</span><span style="--0:#7FDBCA">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export default function App() {  const listRef = useRef()  const [count, setCount] = useState(2)  const [fruits, setFruits] = useState([&#x27;apple&#x27;, &#x27;peach&#x27;])  const onListMutation = useCallback(    (mutationList) => {      setCount(mutationList[0].target.children.length)    },    [setCount],  )  useMutationObservable(listRef.current, onListMutation)  return (    <div>      <span>{&#x60;Added ${count} fruits&#x60;}</span>      <br />      <button onClick={() => setFruits([...fruits, &#x60;random fruit ${fruits.length}&#x60;])}>Add random fruit</button>      <ul ref={listRef}>        {fruits.map((f) => (          <li key={f}>{f}</li>        ))}      </ul>    </div>  )}"><div></div></button></div></figure></div>
<p>We want to trigger a callback function whenever our <code>list</code> element is mutated. Within the callback we refer to, the element’s children give us the number of elements in the list.</p>
<h2 id="implementing-the-usemutationobservable-custom-hook"><a class="__permalink-h" href="#implementing-the-usemutationobservable-custom-hook" aria-label="implementing the usemutationobservable custom hook permalink">»</a>Implementing the <code>useMutationObservable</code> custom Hook</h2>
<p>Let’s look at the integration point:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">listRef</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">current</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">onListMutation</span><span style="--0:#D6DEEB">)</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="useMutationObservable(listRef.current, onListMutation)"><div></div></button></div></figure></div>
<p>The above <code>useMutationObservable</code> custom Hook abstracts the necessary operations to observe changes on the element passed as the first parameter. It then runs the callback passed as the second parameter whenever the target element changes.</p>
<p>Now, let’s implement our <code>useMutationObservable</code> custom Hook.</p>
<p>In the Hook, there are a number of boilerplate operations to understand. First, we must provide a set of options that comply with the <code>MutationObserver</code> API.</p>
<p>Once a <code>MutationObserver</code> instance is created, we must call <code>observe</code> to listen for changes in the targeted DOM element.</p>
<p>When we no longer need to listen to the changes, we must call <code>disconnect</code> on the observer to clean up our subscription. This must happen when the <code>App</code> component unmounts:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#C792EA;--1:#8D46B4"> = {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">config: { attributes: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4">, childList: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4">, subtree: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4"> },</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">targetEl</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">observer</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--0:#C792EA;--1:#8D46B4">] = </span><span style="--0:#82AAFF;--1:#3C63B3">useState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">null</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">obs</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">MutationObserver</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">obs</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> [</span><span style="--0:#D7DBE0">cb</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">options</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">setObserver</span><span style="--0:#D6DEEB">])</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">!</span><span style="--1:#403F53"><span style="--0:#D7DBE0">observer</span><span style="--0:#D6DEEB">) </span></span><span style="--0:#C792EA;--1:#8D46B4">return</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">config</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#D7DBE0;--1:#403F53">options</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#097174">observer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">observe</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">targetEl</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">config</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">observer</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#097174">observer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">disconnect</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> [</span><span style="--0:#D7DBE0">observer</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">targetEl</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">])</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const DEFAULT_OPTIONS = {  config: { attributes: true, childList: true, subtree: true },}function useMutationObservable(targetEl, cb, options = DEFAULT_OPTIONS) {  const [observer, setObserver] = useState(null)  useEffect(() => {    const obs = new MutationObserver(cb)    setObserver(obs)  }, [cb, options, setObserver])  useEffect(() => {    if (!observer) return    const { config } = options    observer.observe(targetEl, config)    return () => {      if (observer) {        observer.disconnect()      }    }  }, [observer, targetEl, options])}"><div></div></button></div></figure></div>
<p>All the above work, including initializing the <code>MutationObserver</code> with the right parameters, observing changes with the call to <code>observer.observe</code>, and cleaning up with <code>observer.disconnect</code>, are abstracted away from the client.</p>
<p>Not only do we export functionality, but we also clean up by hooking into the React components’ lifecycle and by leveraging cleanup callbacks on effect Hooks to tear down the <code>MutationObserver</code> instance.</p>
<p>Now that we have a functional and basic version of our Hook, we can think about improving its quality by iterating on its API and enhancing the developer experience around this shareable piece of code.</p>
<h3 id="input-validation-and-development"><a class="__permalink-h" href="#input-validation-and-development" aria-label="input validation and development permalink">»</a>Input validation and development</h3>
<p>One important aspect when designing custom React Hooks is input validation. We must be able to communicate to developers when things are not running smoothly or a certain use case is hitting an edge case.</p>
<p>Usually, development logs help developers understand unfamiliar code to adjust their implementation. Likewise, we can enhance the above implementation by adding runtime checks and comprehensive warning logs to validate and communicate issues to other developers:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">targetEl</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">observer</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--0:#C792EA;--1:#8D46B4">] = </span><span style="--0:#82AAFF;--1:#3C63B3">useState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">null</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// A)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">!</span><span style="--1:#403F53"><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">typeof</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">!==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">function</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#097174">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">warn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">You must provide a valid callback function, instead you've provided </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">cb</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">return</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">debounceTime</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#D7DBE0;--1:#403F53">options</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">obs</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">MutationObserver</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">obs</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> [</span><span style="--0:#D7DBE0">cb</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">options</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">setObserver</span><span style="--0:#D6DEEB">])</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">!</span><span style="--1:#403F53"><span style="--0:#D7DBE0">observer</span><span style="--0:#D6DEEB">) </span></span><span style="--0:#C792EA;--1:#8D46B4">return</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">!</span><span style="--1:#403F53"><span style="--0:#D7DBE0">targetEl</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#809191;--1:#5E6578">// B)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#097174">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">warn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">You must provide a valid DOM element to observe, instead you've provided </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">targetEl</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">config</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#D7DBE0;--1:#403F53">options</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#097174">observer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">observe</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">targetEl</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">config</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8D46B4">catch</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">e</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#809191;--1:#5E6578">// C)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#097174">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">error</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">e</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">observer</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#097174">observer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">disconnect</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> [</span><span style="--0:#D7DBE0">observer</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">targetEl</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">])</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function useMutationObservable(targetEl, cb, options = DEFAULT_OPTIONS) {  const [observer, setObserver] = useState(null)  useEffect(() => {    // A)    if (!cb || typeof cb !== &#x27;function&#x27;) {      console.warn(&#x60;You must provide a valid callback function, instead you&#x27;ve provided ${cb}&#x60;)      return    }    const { debounceTime } = options    const obs = new MutationObserver(cb)    setObserver(obs)  }, [cb, options, setObserver])  useEffect(() => {    if (!observer) return    if (!targetEl) {      // B)      console.warn(&#x60;You must provide a valid DOM element to observe, instead you&#x27;ve provided ${targetEl}&#x60;)    }    const { config } = options    try {      observer.observe(targetEl, config)    } catch (e) {      // C)      console.error(e)    }    return () => {      if (observer) {        observer.disconnect()      }    }  }, [observer, targetEl, options])}"><div></div></button></div></figure></div>
<p>In this example, we’re checking that a callback is passed as a second argument. This API check at runtime can easily alert the developer that something is wrong on the caller side.</p>
<p>We can also see whether the provided DOM element is invalid with an erroneous value provided to the Hook at runtime or not. These are logged together to inform us to quickly resolve the issue.</p>
<p>And, if <code>observe</code> throws an error, we can catch and report it. We must avoid breaking the JavaScript runtime flow as much as possible, so by catching the error, we can choose to either log it or report it depending on the environment.</p>
<h3 id="extensibility-via-configuration"><a class="__permalink-h" href="#extensibility-via-configuration" aria-label="extensibility via configuration permalink">»</a>Extensibility via configuration</h3>
<p>If we want to add more capabilities to our Hook, we should do this in a retro-compatible fashion, such as an opt-in capability that has little or no friction towards its adoption.</p>
<p>Let’s look at how we can optionally debounce the provided callback function so callers can specify an interval of time when no other changes in the target element trigger. This runs the callback once rather than running the same amount of times the element or its children mutated:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> debounce </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">lodash.debounce</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#C792EA;--1:#8D46B4"> = {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">config: { attributes: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4">, childList: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4">, subtree: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">debounceTime: </span><span style="--0:#F78C6C;--1:#AA0982">0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">targetEl</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">observer</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--0:#C792EA;--1:#8D46B4">] = </span><span style="--0:#82AAFF;--1:#3C63B3">useState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">null</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">useEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">!</span><span style="--1:#403F53"><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">typeof</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">!==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">function</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#097174">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">warn</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">You must provide a valida callback function, instead you've provided </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">cb</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">debounceTime</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--1:#403F53"><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">;</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">obs</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">MutationObserver</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D7DBE0;--1:#403F53">debounceTime</span><span style="--0:#C792EA;--1:#8D46B4"> > </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4"> ? </span><span style="--0:#82AAFF;--1:#3C63B3">debounce</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">cb</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--1:#403F53"><span style="--0:#D7DBE0">debounceTime</span><span style="--0:#D6DEEB">)</span></span><span style="--0:#C792EA;--1:#8D46B4"> : </span><span style="--0:#D7DBE0;--1:#403F53">cb</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">setObserver</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">obs</span><span style="--0:#D6DEEB">);</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> [</span><span style="--0:#D7DBE0">cb</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">options</span></span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">setObserver</span><span style="--0:#D6DEEB">]);</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import debounce from &#x22;lodash.debounce&#x22;;const DEFAULT_OPTIONS = {  config: { attributes: true, childList: true, subtree: true },  debounceTime: 0};function useMutationObservable(targetEl, cb, options = DEFAULT_OPTIONS) {  const [observer, setObserver] = useState(null);  useEffect(() => {    if (!cb || typeof cb !== &#x22;function&#x22;) {      console.warn(        &#x60;You must provide a valida callback function, instead you&#x27;ve provided ${cb}&#x60;      );      return;    }    const { debounceTime } = options;    const obs = new MutationObserver(      debounceTime > 0 ? debounce(cb, debounceTime) : cb    );    setObserver(obs);  }, [cb, options, setObserver]);  // ..."><div></div></button></div></figure></div>
<p>This is handy if we must run a heavy operation, such as triggering a web request, ensuring it runs the minimum number of times possible.</p>
<p>Our <code>debounceTime</code> option can now pass into our custom Hook. If a value bigger than <code>0</code> passes to <code>MutationObservable</code>, the callback delays accordingly.</p>
<p>With a simple configuration exposed in our Hook API, we allow other developers to debounce their callbacks which can result in a more performant implementation given that we might drastically reduce the number of times the callback code gets executed.</p>
<p>Of course, we can always debounce the callback on the client side, but this way we enrich our API and make the caller-side implementation smaller and declarative.</p>
<h3 id="testing"><a class="__permalink-h" href="#testing" aria-label="testing permalink">»</a>Testing</h3>
<p>Testing is an essential part of developing any kind of shared capability. It helps us ensure a certain level of quality for generic APIs when they are heavily contributed to and shared.</p>
<p>The <a href="https://blog.logrocket.com/a-quick-guide-to-testing-react-hooks-fa584c415407/">guide to testing React Hooks</a> has expansive detail around testing that can be implemented into this tutorial.</p>
<h3 id="documentation"><a class="__permalink-h" href="#documentation" aria-label="documentation permalink">»</a>Documentation</h3>
<p>Documentation can level up the quality of custom Hooks and make it developer-friendly.</p>
<p>But even when writing plain JavaScript, <a href="https://jsdoc.app/">JSDoc documentation</a> can be written for custom hook APIs to ensure the Hook passes the right message to developers.</p>
<p>Let’s focus on the <code>useMutationObservable</code> function declaration and how to add formatted JSDoc documentation to it:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* This custom hooks abstracts the usage of the Mutation Observer with React components.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* Watch for changes being made to the DOM tree and trigger a custom callback.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{Element}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">targetEl</span><span style="--0:#809191;--1:#616671"> DOM element to be observed</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{Function}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">cb</span><span style="--0:#809191;--1:#616671"> callback that will run when there's a change in targetEl or any</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* child element (depending on the provided options)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{Object}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">options</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{Object}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">options.config</span><span style="--0:#809191;--1:#616671"> check \[options\](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{number}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">[options.debounceTime</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#78CCF0;--1:#406C80">0]</span><span style="--0:#809191;--1:#616671"> a number that represents the amount of time in ms</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">* that you which to debounce the call to the provided callback function</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">useMutationObservable</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">targetEl</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">cb</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">DEFAULT_OPTIONS</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/**  * This custom hooks abstracts the usage of the Mutation Observer with React components.  * Watch for changes being made to the DOM tree and trigger a custom callback.  * @param {Element} targetEl DOM element to be observed  * @param {Function} cb callback that will run when there&#x27;s a change in targetEl or any  * child element (depending on the provided options)  * @param {Object} options  * @param {Object} options.config check \[options\](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe)  * @param {number} [options.debounceTime=0] a number that represents the amount of time in ms  * that you which to debounce the call to the provided callback function  */function useMutationObservable(targetEl, cb, options = DEFAULT_OPTIONS) {"><div></div></button></div></figure></div>
<p>Writing this is not only useful for documentation, but it also leverages IntelliSense capabilities that autocomplete Hook usage and provide spot information for the Hook’s parameters. This saves developers a few seconds per usage, potentially adding up to hours wasted on reading through the code and trying to understand it.</p>
<h2 id="conclusion"><a class="__permalink-h" href="#conclusion" aria-label="conclusion permalink">»</a>Conclusion</h2>
<p>With different kinds of custom Hooks we can implement, we see how they integrate extrinsic APIs into the React world. It’s easy to integrate state management within Hooks and run effects based on inputs from components using the Hook.</p>
<p>Remember that to build quality Hooks, it’s important to:</p>
<ul>
<li>Design easy-to-use, declarative APIs</li>
<li>Enhance the development experience by checking for proper usage and logging warnings and errors</li>
<li>Expose features through configurations, such as the <code>debounceTime</code> example</li>
<li>Ease Hook usage by writing JSDoc documentation</li>
</ul>
<p>You can check the <a href="https://codepen.io/danielcaldas/pen/BaWPWEw">full implementation of the custom React hook here</a>.</p>  </article> <div class="mt-9 flex text-sm font-italic opacity-80"> <span class="ml-auto">Last modified on 14, May, 2025</span> </div> </main> <footer class="mt-12 mb-6 text-sm"> <div class="mb-1"> <span> <a href="/" class="panda-link"> ~/ </a> <span class="mx-1">|</span> </span><span> <a href="mailto:caldasjdaniel@gmail.com" class="panda-link"> contact </a> <span class="mx-1">|</span> </span><span> <a href="https://github.com/danielcaldas/danielcaldas.github.io" class="panda-link"> github </a> <span class="mx-1">|</span> </span><span> <a href="https://www.linkedin.com/in/daniel-caldas/" class="panda-link"> linkedin </a>  </span> </div> <div class="mb-1"> <span>2018-2025</span> </div> </footer> </body></html>