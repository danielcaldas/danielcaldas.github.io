<!DOCTYPE html><html lang="en-US" class="mx-4"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.5.12"><meta name="description" content="Blogpost, note taking and other things"><title>Unit testing with fixtures unleashed - ~/</title><link rel="stylesheet" href="/_astro/bookshelf.DmiATZhB.css">
<style>:root{--color-primary-main: #222222;--color-secondary-main: #444444;--color-text-body: 55 65 81;--color-text-heading: 55 65 81;--color-text-link: var(--color-primary-main);--color-text-link-hover: var(--color-secondary-main);--color-border: var(--color-primary-main);--color-code-bg: #f3f4f6;scroll-behavior:smooth}:root.dark{color-scheme:dark;--color-primary-main: 235 153 161;--color-secondary-main: 226 111 122;--color-text-body: 214 211 209;--color-text-heading: 255 255 255;--color-text-link: var(--color-primary-main);--color-text-link-hover: var(--color-secondary-main);--color-border: var(--color-primary-main);--color-code-bg: #1a202c;scroll-behavior:smooth}body{font-family:Verdana,sans-serif;overflow-y:scroll}img{max-width:28rem}time,div{color:rgb(var(--color-text-heading))}.panda-link-static{text-decoration:none;color:rgb(var(--color-text-link))}.panda-link-static:hover{text-decoration-line:underline;text-underline-offset:4px;cursor:pointer}.panda-link-static:hover{color:rgb(var(--color-text-link-hover));text-decoration-thickness:.125rem;text-underline-offset:5px}.panda-link{text-decoration:none;color:rgb(var(--color-text-link))}.panda-link:hover{cursor:pointer}.panda-link:hover{color:rgb(var(--color-text-link-hover))}a.animated{--animated-underline-from: rgb(var(--color-text-link));--animated-underline-to: rgb(var(--color-text-link));position:relative;box-decoration-break:clone;text-decoration:none}a.animated:after{left:0;right:0;bottom:-4px;content:"";height:2px;width:auto;position:absolute;transform:translateZ(0) scaleX(0);transform-origin:left center;transition:all .25s ease-in-out;background-image:linear-gradient(to right,var(--animated-underline-from),var(--animated-underline-to))}a.animated:hover:after{transform:translateZ(0) scale(1)}a.animated.active:after{transform:translateZ(0) scale(1)}.max-width{margin-left:auto;margin-right:auto;max-width:65ch}.panda-text{--un-text-opacity:1;color:rgb(29 78 216 / var(--un-text-opacity));text-decoration:none;cursor:pointer}.panda-text:hover{text-decoration-line:underline;text-underline-offset:4px}.panda-text:hover{--un-text-opacity:1;color:rgb(29 78 216 / var(--un-text-opacity))}.dark .panda-text,.dark .panda-text:hover{--un-text-opacity:1;color:rgb(245 245 244 / var(--un-text-opacity))}.prose :where(a):not(:where([data-footnote-ref],[data-footnote-backref],.not-prose,.not-prose *)){padding-left:.25rem;padding-right:.25rem;text-decoration-line:underline;text-underline-offset:4px;hover:underline}.prose :where(blockquote):not(:where(.not-prose,.not-prose *)){padding:.5rem .5rem .5rem 1rem;margin:0;--un-bg-opacity:1;background-color:rgb(243 244 246 / var(--un-bg-opacity));border-radius:.125rem .5rem .5rem .125rem;border-left-style:solid;font-size:1rem;line-height:1.5rem;font-weight:400;border-left:6px solid rgb(var(--color-primary-main))!important}.dark .prose :where(blockquote):not(:where(.not-prose,.not-prose *)){--un-bg-opacity:1;background-color:rgb(87 83 78 / var(--un-bg-opacity))}.prose :where(ol>li):not(:where(.not-prose,.not-prose *))::marker,.prose :where(ul>li):not(:where(.not-prose,.not-prose *))::marker,.prose :where(summary):not(:where(.not-prose,.not-prose *))::marker{color:rgb(var(--color-primary-main));margin-right:1rem;font-weight:600}[data-footnote-ref]:before{content:" ["}[data-footnote-ref]:after{content:"] "}[data-footnote-backref]{text-decoration:none}[data-footnote-ref]{font-weight:400;text-decoration:none}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}
</style><script type="module">document.addEventListener("astro:page-load",setup);document.addEventListener("astro:after-swap",setup);
</script>
<script type="module" src="/_astro/page.55INgWwS.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[])})(window,'partytown','forward');/* Partytown 0.8.2 - MIT builder.io */
!function(t,e,n,i,o,r,a,s,d,c,l,p){function u(){p||(p=1,"/"==(a=(r.lib||"/~partytown/")+(r.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(s=setTimeout(f,1e4),e.addEventListener("pt0",w),o?h(1):n.serviceWorker?n.serviceWorker.register(a+(r.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.style.display="block",c.style.width="0",c.style.height="0",c.style.border="0",c.style.visibility="hidden",c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.8.2":"sandbox-sw.html?"+Date.now()),e.querySelector(r.sandboxParent||"body").appendChild(c)}function f(n,o){for(w(),i==t&&(r.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<d.length;n++)(o=e.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=r.nonce,e.head.appendChild(o);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(s)}r=t.partytown||{},i==t&&(r.forward||[]).map((function(e){l=t,e.split(".").map((function(e,n,i){l=l[i[n]]=n+1<i.length?"push"==i[n+1]?[]:l[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);;((d,s)=>(s=d.currentScript,d.addEventListener('astro:before-swap',()=>s.remove(),{once:true})))(document);</script></head> <body class="max-width dark:bg-stone-700"> <div class="my-6 flex"> <a href="/" class="hover:cursor-pointer opacity-100 hover:opacity-80 panda-link"> <i class="hidden">danielcaldas.github.io</i> <h1>~/</h1> </a> <div class="text-sm place-content-center inline ml-auto"> <button id="themeToggle" class="mt-1 cursor-pointer border-0 bg-transparent"> <svg width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="opacity-100 hover:opacity-80"> <path class="fill-black dark:fill-transparent" d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z"></path> <path class="fill-transparent dark:fill-white" d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z"></path> </svg> </button> <script>
    function handleToggleClick() {
        const element = document.documentElement
        element.classList.toggle('dark')
        const isDark = element.classList.contains('dark')
        localStorage.setItem('theme', isDark ? 'dark' : 'light')
    }

    function setup() {
        let current_theme
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            current_theme = localStorage.getItem('theme')
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            current_theme = 'dark'
        }
        current_theme = current_theme || 'light'
        if (current_theme === 'light') {
            document.documentElement.classList.remove('dark')
        } else {
            document.documentElement.classList.add('dark')
        }
        window.localStorage.setItem('theme', current_theme)
        // button event bind
        document.getElementById('themeToggle').addEventListener('click', handleToggleClick)
    }

    setup()
</script>  </div> </div>  <main>  <a rel="prefetch" class="panda-link mt-6" href="/">Back</a> <style>
        /* notification */
        .notification p {
            margin-top: 0;
            margin-bottom: 0;
            padding: 0.5rem 1rem;
            font-size: small;
        }

        .notification-warning {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }

        .notification-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .notification-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .notification-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .dark .notification-warning {
            background-color: #856404;
            border-color: #ffeeba;
            color: #fff3cd;
        }

        .dark .notification-danger {
            background-color: #721c24;
            border-color: #f5c6cb;
            color: #f8d7da;
        }

        .dark .notification-success {
            background-color: #155724;
            border-color: #c3e6cb;
            color: #d4edda;
        }

        .dark .notification-info {
            background-color: #0c5460;
            border-color: #bee5eb;
            color: #d1ecf1;
        }
    </style> <div class="mt-6"> <h1 class="text-4xl">Unit testing with fixtures unleashed</h1> <div class="flex sm:flex-row flex-col rounded-lg bg-stone-100 dark:bg-stone-600 p-2 px-4"> <div> <span class="ml-2"> <a href="/tags/javascript" class="text-sm mr-2 panda-link">
#javascript </a> </span><span class="ml-2"> <a href="/tags/productivity" class="text-sm mr-2 panda-link">
#productivity </a> </span><span class="ml-2"> <a href="/tags/software-testing" class="text-sm mr-2 panda-link">
#software-testing </a> </span> </div> <span class="ml-auto mr-4 text-sm font-normal"> Posted on 15, Oct, 2019</span> </div> </div> <article class="prose dark:prose-invert prose-stone max-w-prose mt-6">  <p>From project to project, Iâ€™ve seen applications structured in many different ways, but most of the time, no matter how different the software was, the testing techniques and structures were almost always the same. In this article, I want to share with you an experienced-based journey on how we can differently structure our tests; <strong>Iâ€™m calling it a fixture based architecture</strong>.</p>
<h3 id="about-the-unit-tests-we-write"><a class="__permalink-h" href="#about-the-unit-tests-we-write" aria-label="about the unit tests we write permalink">Â»</a>About the unit tests we write</h3>
<p><strong>On a very high level, manipulating the execution flow through inputs, and performing assertions on outputs is what happens with all the tests that we write</strong> daily (weekly at least I hope), at different levels of granularity. Whether we want to test a small function or a large JavaScript module with multiple entry points, our ultimate goal is to perform a set of assertions that bring us the peace of mind and stability to move forward and build more stuff on top.</p>
<p>It happens that <strong>in specific scenarios</strong>, unit tests as we write them <strong>might become pure overhead</strong>. How come? Because we repeat the same structures, and we write the same boilerplate code again and again, without really thinking about how these particular tests could become more pleasant to maintain and scale. Why should I care about looking for alternatives? Because it can save you time, it <strong>can document your codebase through well organized and self-explanatory test fixtures</strong>.</p>
<p>Letâ€™s take a look at how we can move on from a <em>routine</em> unit test setup, to a fixture based setup, through a dummy case study that I specially designed to demonstrate how tests can be set up in a much more declarative way.</p>
<p><img  src="/_astro/bear-meme.pSaa-EXv_Z2jIPSK.webp" alt="bear, funny, meme" title="bear, funny, meme" width="500" height="500" loading="lazy" decoding="async"></p>
<p><cite>source: <a href="https://makeameme.org/meme/im-so-excited-5af9fa">https://makeameme.org/meme/im-so-excited-5af9fa</a></cite></p>
<h3 id="test-fixtures"><a class="__permalink-h" href="#test-fixtures" aria-label="test fixtures permalink">Â»</a>Test fixtures</h3>
<p>Before diving into details, letâ€™s take a few seconds to go through this definition of test fixtures that I came across in the <a href="https://github.com/junit-team/junit4/wiki/test-fixtures" target="_blank" title="junit-team/junit4 description of test fixtures">junit-team/junit4 GitHub wiki page</a>, In my opinion is extremely accurate.</p>
<blockquote>
<p>A test fixture is a fixed state of a set of objects used as a baseline for running tests. The purpose of a test fixture is to ensure that there is a well known and fixed environment in which tests are run so that results are repeatable. Examples of fixtures:</p>
</blockquote>
<ul>
<li>Preparation of input data and setup/creation of fake or mock objects</li>
<li>Loading a database with a specific, known set of data</li>
<li>Copying a specific known set of files creating a test fixture will create a set of objects initialized to certain states.</li>
</ul>
<h3 id="a-case-study"><a class="__permalink-h" href="#a-case-study" aria-label="a case study permalink">Â»</a>A case study</h3>
<p><strong>Slowly moving to a fixture based test setup</strong></p>
<p>Iâ€™ll create a small project to illustrate the concepts throughout this article, all the code is available in the repository <a href="https://github.com/danielcaldas/test-fixtures-pattern" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project">danielcaldas/test-fixtures-pattern</a>. The project itâ€™s not actually something that you would use, but itâ€™s a good example to depict and analyze certain scenarios.</p>
<h4 id="small-dummy-example-for-our-case-study"><a class="__permalink-h" href="#small-dummy-example-for-our-case-study" aria-label="small dummy example for our case study permalink">Â»</a>ðŸ“œ Small &#x26; dummy example for our case study</h4>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.ggich.css"><script type="module" src="/_astro/ec.dy9ns.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ replacer.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â””â”€â”€ __tests__</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ replacer.test.js</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">â””â”€â”€ __snapshots__</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">â””â”€â”€ replacer.test.js.snap</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="â”œâ”€â”€ replacer.jsâ””â”€â”€ __tests__    â”œâ”€â”€ replacer.test.js    â””â”€â”€ __snapshots__        â””â”€â”€ replacer.test.js.snap"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">replacer.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">* Replaces background color that matches a certain color by another.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{string}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">target</span><span style="--0:#809191;--1:#616671"> a css line</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@param</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{Object}</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#78CCF0;--1:#406C80">options</span><span style="--0:#809191;--1:#616671"> a set of options for the new color.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">* </span><span style="--0:#C792EA;--1:#8D46B4">@returns</span><span style="--0:#809191;--1:#616671"> </span><span style="--0:#7690A6;--1:#4F687D">{string}</span><span style="--0:#809191;--1:#616671"> the replaced expression or</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">* the same as the input if nothing matches.</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671"> </span></span><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">fromColor</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">toColor</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">opacity</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#D7DBE0;--1:#403F53">options</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">bgc</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">background-color: rgb(</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#7FDBCA;--1:#097174">fromColor</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#ECC48D;--1:#9B504E">, </span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">)</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">===</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">bgc</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">&#x26;&#x26;</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">toColor</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">&#x26;&#x26;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">toColor</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">length</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">color</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">toColor</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">opacity</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">background-color: rgba(</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">color</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">, </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">opacity</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">)</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">background-color: rgb(</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">color</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">)</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">target</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C5E478;--1:#3C63B3">module</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#C5E478;--1:#3C63B3">exports</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">backgroundColorReplacer</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/** * Replaces background color that matches a certain color by another. * @param {string} target a css line * @param {Object} options a set of options for the new color. * @returns {string} the replaced expression or * the same as the input if nothing matches. */function backgroundColorReplacer(target, options) {  const { fromColor, toColor, opacity } = options  const bgc = &#x60;background-color: rgb(${fromColor.join(&#x27;, &#x27;)})&#x60;  if (target === bgc &#x26;&#x26; toColor &#x26;&#x26; toColor.length) {    const color = toColor.join(&#x27;, &#x27;)    if (opacity) {      return &#x60;background-color: rgba(${color}, ${opacity})&#x60;    }    return &#x60;background-color: rgb(${color})&#x60;  }  return target}module.exports = backgroundColorReplacer"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/replacer.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, replacer.js">
    [replacer.js]
  </a>
</small>
<p>So basically, we have a function that performs replacement of <code>background-color</code> expressions given a set of options, this is very minimalistic, but the number of options can quickly scale to a few dozens depending on what kind of replacements one might want to perform in the future. The unit tests for this function might look like the following.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">replacer.test.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">../replacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">describe</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backgroundColorReplacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">should replace color if they match</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">target</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">background-color: rgb(255, 0, 0)</span><span style="--0:#D9F5DD;--1:#111111">'</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fromColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">options</span><span style="--0:#C792EA;--1:#8D46B4"> = { </span><span style="--0:#D7DBE0;--1:#403F53">fromColor</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">))</span></span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toMatchSnapshot</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const backgroundColorReplacer = require(&#x27;../replacer&#x27;)describe(&#x27;backgroundColorReplacer&#x27;, () => {  it(&#x27;should replace color if they match&#x27;, () => {    const target = &#x27;background-color: rgb(255, 0, 0)&#x27;    const fromColor = [255, 0, 0]    const toColor = [0, 255, 0]    const options = { fromColor, toColor }    expect(backgroundColorReplacer(target, options)).toMatchSnapshot()  })})"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/__tests__/replacer.test.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, replacer.test.js">
    [replacer.test.js]
  </a>
</small>
<br>
<br>
<h4 id="a-few-weeks-down-the-road"><a class="__permalink-h" href="#a-few-weeks-down-the-road" aria-label="a few weeks down the road permalink">Â»</a>ðŸ“† A few weeks down the road</h4>
<p>Letâ€™s imagine that you and your team have now been using and developing this replacer code for 2 months. Itâ€™s fantastic, everybody loves it, but thereâ€™s some edge case that needs attention. The developers are all over it!</p>
<p>Letâ€™s take a look at the test file after 2 months, there are a couple of other features available, therefore a few more tests were implemented.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">replacer.test.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">../replacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">describe</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backgroundColorReplacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">should replace color if they match</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">target</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">background-color: rgb(255, 0, 0)</span><span style="--0:#D9F5DD;--1:#111111">'</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fromColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">options</span><span style="--0:#C792EA;--1:#8D46B4"> = { </span><span style="--0:#D7DBE0;--1:#403F53">fromColor</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">))</span></span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toMatchSnapshot</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">should replace color if they match and add opacity when defined</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">should not replace color if they do not match</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">should not replace color there is no new color specified</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const backgroundColorReplacer = require(&#x27;../replacer&#x27;)describe(&#x27;backgroundColorReplacer&#x27;, () => {  it(&#x27;should replace color if they match&#x27;, () => {    const target = &#x27;background-color: rgb(255, 0, 0)&#x27;    const fromColor = [255, 0, 0]    const toColor = [0, 255, 0]    const options = { fromColor, toColor }    expect(backgroundColorReplacer(target, options)).toMatchSnapshot()  })  it(&#x27;should replace color if they match and add opacity when defined&#x27;, () => {    // ...  })  it(&#x27;should not replace color if they do not match&#x27;, () => {    // ...  })  it(&#x27;should not replace color there is no new color specified&#x27;, () => {    // ...  })})"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/__tests__/replacer.test.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, replacer.test.js">
    [replacer.test.js]
  </a>
</small>
<p>Now the function supports an <code>opacity</code> option, and there are a few more test cases. Eventually some nesting and branching in the <code>describe</code>/<code>it</code> <em>madness</em> starts to stack up on an overwhelmingly large file. The developer has a tough time to go through the test cases and find the right spot for the scenario he/she just fixed. On top of that, any addition to that file seems to break a few other unit tests that arenâ€™t in any way related to the new test case he/she is trying to introduce.</p>
<h3 id="rethinking-the-tests-architecture"><a class="__permalink-h" href="#rethinking-the-tests-architecture" aria-label="rethinking the tests architecture permalink">Â»</a>Rethinking the tests architecture</h3>
<p>Itâ€™s time to rethink the way we structure the tests for this project. Letâ€™s give a try and use fixtures to architect our new test setup.</p>
<p>First of all, notice that no matter the scenario, we have a single entry point <code>backgroundColorReplacer</code> that receives two arguments, a line of some CSS file as a string, and an object with a set of options to manipulate the replacement.</p>
<p>Second letâ€™s think of each test case as a unique scenario with its own description.</p>
<p>Third, letâ€™s separate boilerplate code from the code that itâ€™s actually particular to each test case.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">some description</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// setup code...</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// some operations...</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">))</span></span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toMatchSnapshot</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="it(&#x27;some description&#x27;, () => {  // setup code...  // some operations...  expect(backgroundColorReplacer(target, options)).toMatchSnapshot()})"><div></div></button></div></figure></div>
<p>Above you can see a skeleton structure of what we repeat time after time; you open the test block, your perform a set of assignments and operations on some variables that shape your test case, and in the end, you perform an assertion on the result of calling the replacer function.</p>
<p>Letâ€™s separate the scenario setup and the above boilerplate code, in ways that you need only to <del>write</del> <strong>describe</strong> for each test case its inputs. You wonâ€™t be writing anymore the boilerplate code for the test setup, or the assertion statement.</p>
<p>Our new projectâ€™s file tree now looks like:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ fixtures</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â  â”œâ”€â”€ not-replace-color-if-no-match.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â  â”œâ”€â”€ not-replace-color-if-no-new-color-specified.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â  â”œâ”€â”€ replace-color-when-match-and-opacity-defined.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â  â”œâ”€â”€ replace-color-when-match.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â  â””â”€â”€ tests (auto-generated content)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â      â”œâ”€â”€ fixtures.spec.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â      â””â”€â”€ __snapshots__</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”‚Â Â          â””â”€â”€ fixtures.spec.js.snap</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ replacer.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ run-fixtures.js</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">â””â”€â”€ __tests__</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">â”œâ”€â”€ replacer.test.js</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">â””â”€â”€ __snapshots__</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="â”œâ”€â”€ fixturesâ”‚Â Â  â”œâ”€â”€ not-replace-color-if-no-match.jsâ”‚Â Â  â”œâ”€â”€ not-replace-color-if-no-new-color-specified.jsâ”‚Â Â  â”œâ”€â”€ replace-color-when-match-and-opacity-defined.jsâ”‚Â Â  â”œâ”€â”€ replace-color-when-match.jsâ”‚Â Â  â””â”€â”€ tests (auto-generated content)â”‚Â Â      â”œâ”€â”€ fixtures.spec.jsâ”‚Â Â      â””â”€â”€ __snapshots__â”‚Â Â          â””â”€â”€ fixtures.spec.js.snapâ”œâ”€â”€ replacer.jsâ”œâ”€â”€ run-fixtures.jsâ””â”€â”€ __tests__    â”œâ”€â”€ replacer.test.js    â””â”€â”€ __snapshots__"><div></div></button></div></figure></div>
<p>So our test consists now on declaring the inputs for the replacer function, nothing else. Letâ€™s take a look at <code>fixtures/replace-color-when-match.js</code>.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">replace-color-when-match.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">target</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">background-color: rgb(255, 0, 0)</span><span style="--0:#D9F5DD;--1:#111111">'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fromColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">255</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">options</span><span style="--0:#C792EA;--1:#8D46B4"> = { </span><span style="--0:#D7DBE0;--1:#403F53">fromColor</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">toColor</span><span style="--0:#C792EA;--1:#8D46B4"> }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C5E478;--1:#3C63B3">module</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#C5E478;--1:#3C63B3">exports</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> { </span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB"> }</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const target = &#x27;background-color: rgb(255, 0, 0)&#x27;const fromColor = [255, 0, 0]const toColor = [0, 255, 0]const options = { fromColor, toColor }module.exports = { target, options }"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/fixtures/replace-color-when-match.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, replace-color-when-match.js">
    [fixtures/replace-color-when-match.js]
  </a>
</small>
<p>Some things are still unclear tough. How do we run the tests? How exactly are these fixtures going to be fed to the replacer? Also, how will our test reports look like?</p>
<p>For that, we need to take a look into <code>run-fixtures.js</code>.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">run-fixtures.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fs</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">fs</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">FIXTURES_BASE_DIR</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">__dirname</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">/fixtures</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">generateFixtureJestSnippets</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">files</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">open</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">    </span></span><span style="--0:#ECC48D;--1:#3C63B3">// WARNING: this file is generated automatically</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">    </span></span><span style="--0:#ECC48D;--1:#3C63B3">const backgroundColorReplacer = require('../../replacer');</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">    </span></span><span style="--0:#ECC48D;--1:#3C63B3">describe('backgroundColorReplacer', () => {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">close</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">});</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">specs</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D7DBE0;--1:#403F53">files</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">fname</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">input</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">fs</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">readFileSync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#82AAFF;--1:#3C63B3">FIXTURES_BASE_DIR</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">/</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">fname</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">specName</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">fname</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">split</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">.js</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)[</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">replace</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">/</span><span style="--0:#82AAFF;--1:#3C63B3">[-]</span><span style="--0:#D9F5DD;--1:#111111">/</span><span style="--0:#5CA7E4;--1:#3A6A90">gi</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">        </span></span><span style="--0:#ECC48D;--1:#3C63B3">it("</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">specName</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">", () => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">          </span></span><span style="--0:#ECC48D;--1:#3C63B3">try {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">            </span></span><span style="--0:#ECC48D;--1:#3C63B3">const { target, options } = require(</span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">../</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">fname</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">            </span></span><span style="--0:#ECC48D;--1:#3C63B3">expect(backgroundColorReplacer(target, options)).toMatchSnapshot();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">          </span></span><span style="--0:#ECC48D;--1:#3C63B3">} catch(error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">            </span></span><span style="--0:#ECC48D;--1:#3C63B3">expect(error).toMatchSnapshot();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">          </span></span><span style="--0:#ECC48D;--1:#3C63B3">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#ECC48D;--1:#3C63B3">        </span></span><span style="--0:#ECC48D;--1:#3C63B3">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#F78C6C;--1:#AA0982">\n</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D7DBE0;--1:#403F53">open</span><span style="--0:#DD6B68;--1:#B73936">}${</span><span style="--0:#D7DBE0;--1:#403F53">specs</span><span style="--0:#DD6B68;--1:#B73936">}${</span><span style="--0:#D7DBE0;--1:#403F53">close</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">function</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">parseFileTree</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">err</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">files</span></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">tmp</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">generateFixtureJestSnippets</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">files</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">filter</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">f</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D7DBE0;--1:#403F53">f</span><span style="--0:#C792EA;--1:#8D46B4"> !== </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">tests</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">fs</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">writeFileSync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#82AAFF;--1:#3C63B3">FIXTURES_BASE_DIR</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">/tests/fixtures.spec.js</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">tmp</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#097174">fs</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">readdir</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">FIXTURES_BASE_DIR</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">parseFileTree</span><span style="--0:#D6DEEB">)</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const fs = require(&#x27;fs&#x27;)const FIXTURES_BASE_DIR = &#x60;${__dirname}/fixtures&#x60;function generateFixtureJestSnippets(files) {  // ...  const open = &#x60;    // WARNING: this file is generated automatically    const backgroundColorReplacer = require(&#x27;../../replacer&#x27;);    describe(&#x27;backgroundColorReplacer&#x27;, () => {  &#x60;  const close = &#x60;});&#x60;  const specs = files    .map((fname) => {      const input = fs.readFileSync(&#x60;${FIXTURES_BASE_DIR}/${fname}&#x60;)      const specName = fname.split(&#x27;.js&#x27;)[0].replace(/[-]/gi, &#x27; &#x27;)      return &#x60;        it(&#x22;${specName}&#x22;, () => {          try {            const { target, options } = require(\&#x60;../${fname}\&#x60;);            expect(backgroundColorReplacer(target, options)).toMatchSnapshot();          } catch(error) {            expect(error).toMatchSnapshot();          }        });      &#x60;    })    .join(&#x27;\n&#x27;)  return &#x60;${open}${specs}${close}&#x60;}function parseFileTree(err, files) {  // ...  const tmp = generateFixtureJestSnippets(files.filter((f) => f !== &#x27;tests&#x27;))  fs.writeFileSync(&#x60;${FIXTURES_BASE_DIR}/tests/fixtures.spec.js&#x60;, tmp)}fs.readdir(FIXTURES_BASE_DIR, parseFileTree)"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/run-fixtures.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, run-fixtures.js">
    [run-fixtures.js]
  </a>
</small>
<p>Next, we dive deep into this <code>run-fixtures.js</code> script and in its results.</p>
<h3 id="the-results"><a class="__permalink-h" href="#the-results" aria-label="the results permalink">Â»</a>The results</h3>
<p><strong>Generating test snippets and executing them with Jest</strong></p>
<p>The code in <code>run-fixtures.js</code> generates a test snippet for each one of the test fixtures that you specified within the <code>fixtures</code> directory. Of course, there are a lot of different approaches here. You can implement this script in many different ways, its scope, however, should ideally not change much, it should be: <strong>to <em>glue</em> your scenarios and the underlying test runner</strong>.</p>
<p>The output of running the <code>run-fixtures.js</code> script is a familiar <em>â€œJest compliantâ€</em> file:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">fixtures.spec.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// WARNING: this file is generated automatically</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">../../replacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">describe</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backgroundColorReplacer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">not replace color if no match</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">target</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#82AAFF;--1:#3C63B3">options</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">../not-replace-color-if-no-match.js</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">backgroundColorReplacer</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">target</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">options</span><span style="--0:#D6DEEB">))</span></span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toMatchSnapshot</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8D46B4">catch</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> (</span><span style="--0:#D7DBE0">error</span><span style="--0:#D6DEEB">) {</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">error</span><span style="--0:#D6DEEB">)</span></span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toMatchSnapshot</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">not replace color if no new color specified</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">replace color when match and opacity defined</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">it</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">replace color when match</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#5E6578">// ...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// WARNING: this file is generated automaticallyconst backgroundColorReplacer = require(&#x27;../../replacer&#x27;)describe(&#x27;backgroundColorReplacer&#x27;, () => {  it(&#x27;not replace color if no match&#x27;, () => {    try {      const { target, options } = require(&#x60;../not-replace-color-if-no-match.js&#x60;)      expect(backgroundColorReplacer(target, options)).toMatchSnapshot()    } catch (error) {      expect(error).toMatchSnapshot()    }  })  it(&#x27;not replace color if no new color specified&#x27;, () => {    // ...  })  it(&#x27;replace color when match and opacity defined&#x27;, () => {    // ...  })  it(&#x27;replace color when match&#x27;, () => {    // ...  })})"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/fixtures/tests/fixtures.spec.js" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, fixtures.spec.js">
    [fixtures.spec.js]
  </a>
</small>
<p>The output or running the above test is just a simple Jest report.</p>
<p><img  src="/_astro/final-test-report.Cgkiu_DB_1ozlBW.webp" alt="Jest, final test report" title="Jest, final test report" width="920" height="427" loading="lazy" decoding="async"></p>

<p>In the above implementation we have created a generic mechanism that resembles the <em>Command Pattern</em> (<a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank" rel="nofollow" title="Learning JavaScript Design Patterns">reference from â€œLearning JavaScript Design Patternsâ€ by Addy Osmani</a>) where the <em>spec</em> name itself is the <em>command</em> we wish to execute.</p>
<p>My goal here is to give you the idea that, in some projects, you might be able to drop a lot of boilerplate by wisely choosing your testing architecture; The pattern you go for itâ€™s just a tool for you to organize your thoughts, <strong>it doesnâ€™t mean that</strong> if you donâ€™t choose the right architecture you are doomed to a poorly tested codebase, you can still certainly achieve that, it just wonâ€™t be as easy.</p>
<h4 id="bonus-section-development-watch-mode-for-fixtures"><a class="__permalink-h" href="#bonus-section-development-watch-mode-for-fixtures" aria-label="bonus section development watch mode for fixtures permalink">Â»</a>ðŸŽ° Bonus section: development watch mode for fixtures</h4>
<p>Another thing that comes in handy when setting up our testing workflow, is to have a way to update the fixtures by tweaking existing test case inputs or adding new ones and automatically re-running the <code>run-fixtures.js</code> script and the unit tests with Jest. How would that go?</p>
<p>If you never tried <a href="https://github.com/remy/nodemon" target="_blank" title="Monitor for any changes in your node.js application and automatically restart the server - perfect for development">nodemon</a>, now itâ€™s a good time to check it out. Itâ€™s a mighty tool to restart some job based on specific changes in your project. Letâ€™s use nodemon to set up a <a href="https://docs.npmjs.com/misc/scripts" target="_blank" title="npm cli documentation about scripts field">npm script</a> that seamlessly re-runs our fixtures. The idea is that we achieve the same workflow that we would normally have with <a href="https://jestjs.io/docs/en/cli#watchall" target="_blank" title="Jest cli, watch all option">jest â€”watchAll</a>, on our fixtures folder. After installing nodemon, we just need to use the <a href="https://github.com/remy/nodemon#monitoring-multiple-directories" target="_blank" title="Monitor for any changes in your node.js application and automatically restart the server - perfect for development, watch mode">â€”watch</a> option to check for changes in our fixtures.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">package.json</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">fixtures:run</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">node run-fixtures &#x26;&#x26; jest ./fixtures/tests/fixtures.spec.js</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">fixtures:clean</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">...</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">fixtures:watch</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">nodemon --watch ./fixtures --ignore ./fixtures/tests --exec </span><span style="--0:#F78C6C;--1:#AA0982">\"</span><span style="--0:#ECC48D;--1:#9B504E">npm run fixtures:run</span><span style="--0:#F78C6C;--1:#AA0982">\"</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="&#x22;fixtures:run&#x22;: &#x22;node run-fixtures &#x26;&#x26; jest ./fixtures/tests/fixtures.spec.js&#x22;,&#x22;fixtures:clean&#x22;: &#x22;...&#x22;,&#x22;fixtures:watch&#x22;: &#x22;nodemon --watch ./fixtures --ignore ./fixtures/tests --exec \&#x22;npm run fixtures:run\&#x22;&#x22;"><div></div></button></div></figure></div>
<small>
  <a href="https://github.com/danielcaldas/test-fixtures-pattern/blob/master/package.json" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project, package.json">
    [package.json]
  </a>
</small>
<p>As you can see from the above snippet, we <em>glue</em> and chain everything together in the script <code>fixtures:watch</code>. In fact, nodemon does most of the work. Now when we want to perform interactive changes in our fixtures we just need to type <code>npm run fixtures:watch</code>, and <em>voilÃ </em>. See the result below.</p>
<gif name="fixtures-watch-mode">

<p>I found such a setup to be the ideal driver for you to advocate for <a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" title="Test-driven development - Wikipedia">Test Driven Development (TDD)</a> within your team. Creating fixtures to replicate tricky edge cases
becomes trivial leading you to create the fixture that breaks your implementation in the first place, followed by fixing whatever is wrong with the actual implementation.
But I donâ€™t want to elaborate on TDD, for that I would rather point you good resources such as <em>â€œTest Driven Development: By Exampleâ€ (a book by Kent Beck)</em>.</p>
<br>
<h3 id="projects-using-fixtures"><a class="__permalink-h" href="#projects-using-fixtures" aria-label="projects using fixtures permalink">Â»</a>Projects using fixtures?</h3>
<p>If you read the article up to this point, you may now have an idea of how a fixture based architecture might look like. In real life, they appear in many other different colors and formats. Some known projects that use this pattern are:</p>
<ul>
<li><a href="https://github.com/facebook/react" target="\_blank" title="A declarative, efficient, and flexible JavaScript library for building user interfaces. https://reactjs.org">facebook/react</a></li>
<li><a href="https://github.com/babel/babel" target="\_blank" title="Babel is a compiler for writing next generation JavaScript. https://babeljs.io/">babel/babel</a></li>
<li><a href="https://github.com/pugjs/pug" target="\_blank" title="Pug â€“ robust, elegant, feature rich template engine for Node.js https://pugjs.org">pugjs/pug</a></li>
<li><a href="https://github.com/webpack/webpack" target="\_blank" title="A bundler for javascript and friends. Packs many modules into a few bundled assets">webpack/webpack</a></li>
</ul>
<p>Not a known project, but the babel plugin where I first implemented such architecture in <a href="https://danielcaldas.github.io/posts/presenting-babel-plugin-cloudinary/" target="_blank" title="danielcaldas.github.io, blog post, Presenting babel-plugin-cloudinary">babel-plugin-cloudinary</a>, if you check the test setup, you might quickly identify the patterns explored in this article.</p>
<p>Do you see any similarities between all the listed projects? I do! We could say that they are all compilers, in their own ways. They often have a <strong>vast spectrum of inputs and narrow APIs, often exposed via a <code>compile</code> function</strong>.</p>
<small>
  <b>tip</b>: to have a big picture of how these projects run fixtures, go to their repository and perform a search for
  "fixtures/" and you'll see *glue* code somewhat related to the one demonstrated in this article; it might be a bit
  harder to follow due to the dimension of these projects
</small>
.
<h3 id="reasons-not-to"><a class="__permalink-h" href="#reasons-not-to" aria-label="reasons not to permalink">Â»</a>Reasons not toâ€¦</h3>
<p><img  src="/_astro/whats-the-catch-meme.CENb4V25_ZnDvGu.webp" alt="so, what is the catch, meme" title="so, what is the catch, meme" width="600" height="471" loading="lazy" decoding="async"></p>
<p><cite><a href="https://imgflip.com/memegenerator/33897585/dave-chappelle">https://imgflip.com/memegenerator/33897585/dave-chappelle</a></cite></p>
<p>I can think of two disadvantages that you should consider before exploring this option:</p>
<ul>
<li><strong>Unintended duplication becomes propitious</strong> - since we have a flat and easily scalable structure, it might come the time where you have many scenarios, and someone introduces one or more repeated test cases without being aware of it. To avoid duplication, you can put in place, since the very beginning, some proper naming conventions for your test cases, such as prefixing common fixtures with some common keywords that show that those scenarios are somewhat related.</li>
<li><strong>Setup might be too complex</strong> - depending on the project and the underlying test runner, it might be more or less complex to put in place such a setup. We saw that with Jest it can be piece of cake <span title="piece of cake">ðŸ°</span>.</li>
</ul>
<h3 id="conclusions"><a class="__permalink-h" href="#conclusions" aria-label="conclusions permalink">Â»</a>Conclusions</h3>
<p>As already mentioned, all the code examples in this blog post are in a <a href="https://github.com/danielcaldas/test-fixtures-pattern" target="_blank" title="GitHub, Daniel Caldas, test-fixtures-pattern case study project">public GitHub repository</a>.<br>
I hope that if you went through the article, you have now one more testing software pattern on your <em>toolbelt</em> that will (for the right use cases) allow you scale the tests in your codebase effortlessly and a in self-documented/self-organized fashion.</p>
<p>What do you think about having a fixture based testing architecture? Do you have any project in mind where you see that this could be the right fit?</p></gif>  </article> <div class="mt-9 flex text-sm font-italic opacity-80"> <span class="ml-auto">Last modified on 14, May, 2025</span> </div> </main> <footer class="mt-12 mb-6 text-sm"> <div class="mb-1"> <span> <a href="/" class="panda-link"> ~/ </a> <span class="mx-1">|</span> </span><span> <a href="mailto:caldasjdaniel@gmail.com" class="panda-link"> contact </a> <span class="mx-1">|</span> </span><span> <a href="https://github.com/danielcaldas/danielcaldas.github.io" class="panda-link"> github </a> <span class="mx-1">|</span> </span><span> <a href="https://www.linkedin.com/in/daniel-caldas/" class="panda-link"> linkedin </a>  </span> </div> <div class="mb-1"> <span>2018-2025</span> </div> </footer> </body></html>